Implement the task according to the plan.

- Write clean code that follows existing patterns in the codebase.
- Stay focused on this issue only. If you discover unrelated problems, file them with `br q "description" --type=bug` and move on.
- Write the tests specified in the issue.
